class AutismKnowledgeBase {
  static const Map<String, Map<String, dynamic>> _knowledge = {
    'definicao': {
      'keywords': ['o que é', 'que é', 'definição', 'conceito', 'autismo', 'tea'],
      'response': '🧠 **TEA (Transtorno do Espectro Autista)**\n\nÉ uma condição neurológica que afeta:\n• **Comunicação** - verbal e não-verbal\n• **Interação social** - relacionamentos\n• **Comportamentos** - padrões repetitivos\n\n💙 Não é doença - é uma forma diferente de processar o mundo!',
      'follow_up': ['sintomas', 'diagnostico', 'causas']
    },
    
    'sintomas_precoces': {
      'keywords': ['sintomas', 'sinais', 'identificar', 'como saber', 'primeiros sinais', 'bebê', 'criança pequena'],
      'response': '👶 **Sinais Precoces (0-3 anos)**\n\n**Comunicação:**\n• Pouco contato visual\n• Não responde ao nome\n• Atraso na fala ou perda de palavras\n• Não aponta para mostrar interesse\n\n**Social:**\n• Não sorri socialmente\n• Prefere brincar sozinho\n• Não imita gestos\n\n**Comportamento:**\n• Movimentos repetitivos\n• Fixação em objetos\n• Resistência a mudanças\n\n⚠️ **Importante:** Apenas profissionais podem diagnosticar!',
      'follow_up': ['diagnostico', 'profissionais', 'quando_procurar']
    },
    
    'sintomas_escolares': {
      'keywords': ['escola', 'sintomas escola', 'professor', 'sala de aula', 'escolar'],
      'response': '🏫 **Sinais na Escola**\n\n**Para Professores:**\n• Dificuldade em seguir instruções complexas\n• Evita atividades em grupo\n• Comportamentos repetitivos\n• Sensibilidade a ruídos/luzes\n• Interesses muito específicos\n• Dificuldade com mudanças na rotina\n\n**Estratégias:**\n• Use comunicação visual\n• Mantenha rotinas previsíveis\n• Ofereça pausas sensoriais\n• Valorize os pontos fortes\n\n📚 Cada criança é única!',
      'follow_up': ['inclusao_escolar', 'estrategias_ensino', 'direitos_escola']
    },
    
    'sintomas_mais_velhos': {
      'keywords': ['filho mais velho', 'criança mais velha', 'sintomas mais velho', 'mais velho', 'idade escolar', '6 anos', '7 anos', '8 anos', '9 anos', '10 anos', 'sintomas filho mais velho'],
      'response': '🧒 **Sintomas em Crianças Mais Velhas (6+ anos)**\n\n**Comunicação:**\n• Linguagem literal, não entende ironias\n• Dificuldade em conversas recíprocas\n• Repete frases ou palavras\n• Voz monótona ou diferente\n\n**Social:**\n• Dificuldade para fazer amigos\n• Não entende regras sociais\n• Prefere brincar sozinho\n• Não compartilha interesses\n\n**Comportamento:**\n• Rotinas rígidas\n• Interesses obsessivos\n• Movimentos repetitivos\n• Resistência a mudanças\n\n**Na Escola:**\n• Dificuldade de concentração\n• Problemas com trabalhos em grupo\n• Sensibilidade sensorial\n\n👩‍⚕️ **Procure avaliação profissional!**',
      'follow_up': ['diagnostico', 'escola', 'terapias']
    },
    
    'diagnostico': {
      'keywords': ['diagnóstico', 'médico', 'profissional', 'como diagnosticar', 'exames'],
      'response': '🏥 **Diagnóstico do TEA**\n\n**Profissionais:**\n• Neuropediatra\n• Psiquiatra infantil\n• Psicólogo especializado\n• Equipe multidisciplinar\n\n**Processo:**\n• Entrevista com família\n• Observação comportamental\n• Escalas padronizadas (CARS, ADI-R, ADOS)\n• Histórico do desenvolvimento\n\n**Idade:** Pode ser feito a partir dos 18 meses\n\n⏰ **Diagnóstico precoce = intervenção mais eficaz!**',
      'follow_up': ['terapias', 'intervencao_precoce', 'onde_buscar_ajuda']
    },
    
    'terapias': {
      'keywords': ['terapia', 'tratamento', 'aba', 'intervenção', 'ajuda', 'como tratar'],
      'response': '🎯 **Principais Terapias**\n\n**ABA (Análise do Comportamento Aplicada):**\n• Ensina habilidades práticas\n• Reduz comportamentos inadequados\n• Baseada em evidências científicas\n\n**Fonoaudiologia:**\n• Desenvolve comunicação\n• Trabalha linguagem verbal/não-verbal\n\n**Terapia Ocupacional:**\n• Atividades da vida diária\n• Integração sensorial\n\n**Psicoterapia:**\n• Regulação emocional\n• Habilidades sociais\n\n**Outras:** Musicoterapia, equoterapia, natação\n\n✨ **Cada pessoa precisa de um plano individualizado!**',
      'follow_up': ['aba_detalhes', 'fonoaudiologia', 'terapia_ocupacional']
    },
    
    'comportamentos_dificeis': {
      'keywords': ['crise', 'birra', 'agressivo', 'comportamento difícil', 'meltdown', 'autolesão'],
      'response': '🧘‍♀️ **Comportamentos Desafiadores**\n\n**Possíveis Causas:**\n• Sobrecarga sensorial\n• Mudança na rotina\n• Frustração/comunicação\n• Fome, sono, dor\n• Ansiedade\n\n**Como Ajudar:**\n• Mantenha-se calmo\n• Identifique o gatilho\n• Reduza estímulos\n• Use poucas palavras, tom suave\n• Ofereça alternativas\n• Valide os sentimentos\n\n**Prevenção:**\n• Rotinas previsíveis\n• Comunicação visual\n• Pausas regulares\n• Ambiente organizado\n\n💙 **Não é birra - é comunicação!**',
      'follow_up': ['estrategias_comportamento', 'sobrecarga_sensorial', 'rotinas']
    },
    
    'familia_apoio': {
      'keywords': ['família', 'pais', 'mãe', 'pai', 'como ajudar família', 'apoio'],
      'response': '👨‍👩‍👧‍👦 **Apoio à Família**\n\n**Para Pais:**\n• Aceite seu filho como ele é\n• Celebre pequenas conquistas\n• Busque informação confiável\n• Conecte-se com outras famílias\n• Cuide da sua saúde mental\n\n**Estratégias Práticas:**\n• Crie rotinas visuais\n• Use interesses da criança\n• Tenha paciência com o desenvolvimento\n• Documente progressos\n\n**Rede de Apoio:**\n• Grupos de pais\n• Associações de autismo\n• Terapeutas\n• Escola\n\n💪 **Você conhece seu filho melhor que ninguém!**',
      'follow_up': ['grupos_apoio', 'autocuidado_pais', 'irmãos_autismo']
    },
    
    'direitos': {
      'keywords': ['direitos', 'lei', 'benefício', 'gratuito', 'bpc', 'carteirinha'],
      'response': '⚖️ **Direitos da Pessoa com TEA**\n\n**Lei 12.764/2012 (Berenice Piana):**\n• Pessoa com deficiência para todos os efeitos legais\n\n**Principais Direitos:**\n• 🎫 Prioridade em filas e atendimentos\n• 🚌 Transporte público gratuito\n• 💰 BPC - Benefício de 1 salário mínimo\n• 🏥 Atendimento especializado no SUS\n• 🏫 Educação inclusiva\n• 💼 Cotas no mercado de trabalho\n• 🎭 Meia-entrada em eventos\n\n**Documentos:**\n• Carteirinha de identificação\n• Laudo médico\n• CID F84\n\n📋 **Use seus direitos!**',
      'follow_up': ['bpc_como_solicitar', 'carteirinha_autismo', 'direitos_escola']
    },
    
    'inclusao_escolar': {
      'keywords': ['inclusão', 'escola inclusiva', 'professor apoio', 'adaptação escolar'],
      'response': '🏫 **Inclusão Escolar**\n\n**Direitos Garantidos:**\n• Matrícula em escola regular\n• Professor de apoio (se necessário)\n• Adaptações curriculares\n• Ambiente acessível\n\n**Estratégias para Professores:**\n• Comunicação visual (pictogramas)\n• Rotinas estruturadas\n• Pausas sensoriais\n• Atividades baseadas em interesses\n• Parceria com família\n\n**Adaptações:**\n• Tempo extra para atividades\n• Avaliações diferenciadas\n• Espaço para autorregulação\n• Redução de estímulos\n\n🌟 **Inclusão beneficia toda a turma!**',
      'follow_up': ['pei_plano', 'professor_apoio', 'adaptacoes_curriculares']
    },
    
    'comunicacao': {
      'keywords': ['comunicação', 'fala', 'linguagem', 'não fala', 'verbal', 'pecs'],
      'response': '🗣️ **Comunicação no TEA**\n\n**Formas de Comunicação:**\n• **Verbal:** palavras, frases\n• **Não-verbal:** gestos, expressões\n• **Visual:** figuras, pictogramas\n• **Tecnológica:** tablets, apps\n\n**Estratégias:**\n• PECS (troca de figuras)\n• Libras ou gestos\n• Comunicação aumentativa\n• Rotinas visuais\n• Histórias sociais\n\n**Dicas Práticas:**\n• Dê tempo para resposta\n• Use linguagem simples\n• Seja paciente e consistente\n\n🎯 **Toda comunicação é válida!**',
      'follow_up': ['pecs', 'apps_comunicacao', 'fonoaudiologia']
    },
    
    'sensorial': {
      'keywords': ['sensorial', 'hipersensibilidade', 'hiposensibilidade', 'ruído', 'textura', 'luz'],
      'response': '🌈 **Questões Sensoriais**\n\n**Hipersensibilidade (muito sensível):**\n• Evita ruídos, luzes fortes\n• Não gosta de certas texturas\n• Incomoda-se com multidões\n• Rejeita alguns alimentos\n\n**Hiposensibilidade (pouco sensível):**\n• Busca estímulos intensos\n• Não sente dor/temperatura\n• Precisa de mais input sensorial\n\n**Estratégias:**\n• Identifique os gatilhos\n• Crie espaços calmos\n• Use fones de ouvido\n• Ofereça alternativas táteis\n• Gradual exposição\n\n🧘 **Terapia ocupacional ajuda muito!**',
      'follow_up': ['terapia_ocupacional', 'dieta_sensorial', 'ambiente_sensorial']
    },
    
    'alimentacao': {
      'keywords': ['alimentação', 'comida', 'seletividade', 'não come', 'textura alimento'],
      'response': '🍽️ **Alimentação no TEA**\n\n**Seletividade Alimentar:**\n• Comum em 70% das crianças\n• Preferências por textura/cor\n• Resistência a novos alimentos\n• Rituais na hora da refeição\n\n**Estratégias:**\n• Introdução gradual\n• Misture alimentos aceitos\n• Deixe explorar sem pressão\n• Modelo (coma junto)\n• Ambiente calmo\n• Horários regulares\n\n**Quando Buscar Ajuda:**\n• Perda de peso\n• Deficiências nutricionais\n• Menos de 20 alimentos aceitos\n\n🥗 **Paciencia e persistência!**',
      'follow_up': ['nutricionista', 'suplementos', 'receitas_sensoriais']
    },
    
    'sono': {
      'keywords': ['sono', 'dormir', 'insônia', 'não dorme', 'acordar noite'],
      'response': '🌙 **Sono no TEA**\n\n**Problemas Comuns:**\n• Dificuldade para adormecer\n• Despertares noturnos\n• Sono fragmentado\n• Resistência à hora de dormir\n\n**Higiene do Sono:**\n• Rotina consistente\n• Ambiente escuro e silencioso\n• Temperatura agradável\n• Evite telas 1h antes\n• Atividade física durante o dia\n\n**Estratégias:**\n• História visual da rotina\n• Música relaxante\n• Massagem suave\n• Objetos de transição\n• Melatonina (com orientação médica)\n\n😴 **Sono de qualidade melhora tudo!**',
      'follow_up': ['rotina_sono', 'melatonina', 'ambiente_dormir']
    },
    
    'tecnologia': {
      'keywords': ['app', 'tecnologia', 'tablet', 'aplicativo', 'digital'],
      'response': '📱 **Tecnologia e TEA**\n\n**Benefícios:**\n• Comunicação aumentativa\n• Aprendizado visual\n• Organização de rotinas\n• Habilidades sociais\n• Autorregulação\n\n**Apps Úteis:**\n• **Comunicação:** Proloquo2Go, PECS\n• **Rotinas:** Choiceworks, First Then\n• **Habilidades Sociais:** Social Stories\n• **Relaxamento:** Calm, Headspace\n• **Educação:** Khan Academy Kids\n\n**Dicas de Uso:**\n• Tempo limitado\n• Conteúdo apropriado\n• Supervisão adulta\n• Equilíbrio com atividades offline\n\n🎯 **Ferramenta, não substituto da interação!**',
      'follow_up': ['apps_comunicacao', 'tempo_tela', 'jogos_educativos']
    },
    
    'casos_praticos': {
      'keywords': ['meu filho', 'minha filha', 'criança', 'o que fazer', 'estou preocupado', 'não sei o que fazer', 'preciso de ajuda'],
      'response': '🤱 **Situações Práticas**\n\n**Se você suspeita de TEA:**\n• Observe sem julgar\n• Anote comportamentos específicos\n• Procure pediatra ou neuropediatra\n• Não compare com outras crianças\n\n**Primeiros Passos:**\n1. Consulta médica especializada\n2. Avaliação multidisciplinar\n3. Início de terapias (se indicado)\n4. Apoio à família\n\n**Lembre-se:**\n• Cada criança é única\n• Diagnóstico precoce ajuda\n• Você não está sozinho\n• Há muito apoio disponível\n\n💙 **O amor e aceitação são fundamentais!**',
      'follow_up': ['diagnostico', 'primeiros_passos', 'apoio_familia']
    },
    
    'emergencia': {
      'keywords': ['crise agora', 'emergência', 'não para de chorar', 'agressivo agora', 'socorro', 'urgente ajuda'],
      'response': '🚨 **Situação de Crise - Ação Imediata**\n\n**AGORA:**\n• Mantenha-se calmo\n• Reduza estímulos (luz, som)\n• Fale baixo e devagar\n• Não force contato físico\n• Ofereça espaço seguro\n\n**NÃO FAÇA:**\n• Não grite ou se desespere\n• Não force a parar\n• Não dê ordens complexas\n• Não toque sem permissão\n\n**DEPOIS DA CRISE:**\n• Ofereça conforto\n• Hidrate a criança\n• Analise possíveis gatilhos\n• Documente o ocorrido\n\n⚠️ **Se houver risco físico, procure ajuda médica imediata!**\n\n💙 **Crises passam. Você consegue!**',
      'follow_up': ['comportamentos_dificeis', 'estrategias_crise', 'apoio_emergencial']
    },
    
    'recursos_gratuitos': {
      'keywords': ['gratuito', 'sem dinheiro', 'não tenho condições', 'sus', 'público', 'barato'],
      'response': '🆓 **Recursos Gratuitos Disponíveis**\n\n**SUS - Sistema Único de Saúde:**\n• Consultas especializadas\n• Terapias (ABA, fono, TO)\n• Medicamentos\n• Acompanhamento multidisciplinar\n\n**APAE - Associação de Pais e Amigos:**\n• Atendimento especializado\n• Terapias\n• Orientação familiar\n• Atividades educativas\n\n**Universidades:**\n• Clínicas-escola\n• Atendimento supervisionado\n• Pesquisas e estudos\n\n**ONGs e Associações:**\n• Grupos de apoio\n• Orientação gratuita\n• Eventos educativos\n• Rede de contatos\n\n📍 **Procure a Secretaria de Saúde da sua cidade!**',
      'follow_up': ['sus_como_acessar', 'apae_local', 'associacoes']
    }
  };

  static const Map<String, String> _quickResponses = {
    'oi': '👋 Oi! Sou especialista em TEA. Como posso ajudar hoje?',
    'olá': '👋 Olá! Estou aqui para esclarecer suas dúvidas sobre autismo.',
    'bom dia': '☀️ Bom dia! Pronto para ajudar com informações sobre TEA.',
    'boa tarde': '🌅 Boa tarde! Como posso auxiliar sobre autismo hoje?',
    'boa noite': '🌙 Boa noite! Estou disponível para suas perguntas sobre TEA.',
    'obrigado': '😊 Por nada! Sempre aqui para ajudar. Cada pessoa com autismo é especial!',
    'obrigada': '😊 Fico feliz em ajudar! Juntos construimos mais inclusão.',
    'tchau': '👋 Até logo! Lembre-se: você não está sozinho nessa jornada!',
    'até mais': '👋 Até mais! Estarei sempre aqui quando precisar.',
    'ajuda': '💡 Posso ajudar com: sintomas, diagnóstico, terapias, escola, família, direitos e desenvolvimento. Seja específico!',
    'não sei': '🤔 Sem problemas! Me conte o que está acontecendo ou qual sua preocupação. Vamos descobrir juntos!',
    'estou perdido': '🦭 Não se preocupe! É normal se sentir assim. Vamos começar pelo básico. O que você gostaria de saber?',
    'urgente': '⚠️ Se for emergência médica, procure ajuda imediata! Para dúvidas sobre TEA, estou aqui para ajudar.',
    'crise': '🆘 Em situações de crise: mantenha calma, reduza estímulos, use voz suave. Precisa de mais orientações?'
  };

  static String? findResponse(String message) {
    final msg = message.toLowerCase().trim();
    
    // Respostas rápidas primeiro
    for (final entry in _quickResponses.entries) {
      if (msg == entry.key || msg.startsWith(entry.key)) {
        return entry.value;
      }
    }
    
    // Busca inteligente com prioridade para correspondências mais específicas
    String? bestMatch;
    int maxMatches = 0;
    double bestScore = 0.0;
    
    for (final entry in _knowledge.entries) {
      final keywords = entry.value['keywords'] as List<String>;
      int matches = 0;
      double score = 0.0;
      
      for (final keyword in keywords) {
        final keywordLower = keyword.toLowerCase();
        if (msg.contains(keywordLower)) {
          matches++;
          // Pontuação maior para correspondências mais específicas
          if (msg == keywordLower) {
            score += 10.0; // Correspondência exata
          } else if (msg.startsWith(keywordLower) || msg.endsWith(keywordLower)) {
            score += 5.0; // Começa ou termina com a palavra
          } else {
            score += 1.0; // Contém a palavra
          }
          
          // Bonus para frases mais longas e específicas
          score += keywordLower.split(' ').length * 0.5;
        }
      }
      
      if (matches > 0 && (matches > maxMatches || (matches == maxMatches && score > bestScore))) {
        maxMatches = matches;
        bestScore = score;
        bestMatch = entry.value['response'] as String;
      }
    }
    
    return bestMatch;
  }
  
  static List<String> getFollowUpSuggestions(String message) {
    final msg = message.toLowerCase().trim();
    
    // Busca sugestões baseadas na melhor correspondência
    String? bestTopic;
    int maxMatches = 0;
    
    for (final entry in _knowledge.entries) {
      final keywords = entry.value['keywords'] as List<String>;
      int matches = 0;
      
      for (final keyword in keywords) {
        if (msg.contains(keyword.toLowerCase())) {
          matches++;
        }
      }
      
      if (matches > maxMatches) {
        maxMatches = matches;
        bestTopic = entry.key;
      }
    }
    
    if (bestTopic != null) {
      return List<String>.from(_knowledge[bestTopic]!['follow_up'] ?? []);
    }
    
    // Sugestões padrão se não encontrar correspondência
    return ['Como identificar autismo?', 'Que terapias funcionam?', 'Direitos da pessoa com TEA'];
  }
  
  static String getDefaultResponse() {
    return '🤖 **Olá! Sou seu assistente especializado em TEA!**\n\n🎯 **Estou aqui para ajudar com:**\n\n**🔍 Identificação:**\n• Sintomas por idade\n• Sinais de alerta\n• Quando procurar ajuda\n\n**🏥 Diagnóstico:**\n• Profissionais indicados\n• Processo de avaliação\n• Recursos gratuitos\n\n**🎯 Intervenções:**\n• Terapias eficazes\n• Estratégias práticas\n• Apoio familiar\n\n**🏫 Educação:**\n• Direitos escolares\n• Inclusão\n• Adaptações\n\n**💡 Exemplos práticos:**\n• "Meu filho de 4 anos não fala"\n• "Como lidar com crises"\n• "Recursos gratuitos na minha cidade"\n• "Direitos na escola"\n\n💙 **Cada pergunta é importante. Como posso ajudar hoje?**';
  }
  
  static List<String> getSmartSuggestions() {
    return [
      'Como identificar sinais precoces?',
      'Meu filho não fala, é autismo?',
      'Como lidar com crises?',
      'Que terapias são mais eficazes?',
      'Direitos na escola',
      'Seletividade alimentar',
      'Problemas de sono',
      'Apps para comunicação',
      'Como conseguir diagnóstico?',
      'Apoio para a família',
      'Recursos gratuitos disponíveis',
      'Sintomas em crianças mais velhas'
    ];
  }
}