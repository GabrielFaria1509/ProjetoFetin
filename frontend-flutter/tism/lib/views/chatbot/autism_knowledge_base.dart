class AutismKnowledgeBase {
  static final Map<String, String> _responseCache = <String, String>{};
  static const int _maxCacheSize = 20;
  
  static const Map<String, Map<String, dynamic>> _knowledge = {
    'definicao': {
      'keywords': ['o que √©', 'que √©', 'defini√ß√£o', 'conceito', 'autismo', 'tea', 'o que √© autismo', 'o que √© tea', 'defina autismo', 'explique autismo'],
      'response': 'üß† **TEA (Transtorno do Espectro Autista)**\n\n√â uma condi√ß√£o neurol√≥gica que afeta:\n‚Ä¢ **Comunica√ß√£o** - verbal e n√£o-verbal\n‚Ä¢ **Intera√ß√£o social** - relacionamentos\n‚Ä¢ **Comportamentos** - padr√µes repetitivos\n\nüíô N√£o √© doen√ßa - √© uma forma diferente de processar o mundo!',
      'follow_up': ['sintomas', 'diagnostico', 'causas']
    },
    
    'sintomas_precoces': {
      'keywords': ['sintomas', 'sinais', 'identificar', 'como saber', 'primeiros sinais', 'beb√™', 'crian√ßa pequena', 'sintoma', 'sinal', 'como identificar', 'quais sintomas', 'que sintomas', 'tem sintomas', 'apresenta sintomas'],
      'response': 'üë∂ **Sinais Precoces do TEA (0-3 anos)**\n\n**üó£Ô∏è Comunica√ß√£o:**\n‚Ä¢ **Contato visual limitado** - evita olhar nos olhos, mesmo durante brincadeiras\n‚Ä¢ **N√£o responde ao nome** - parece n√£o ouvir quando chamado\n‚Ä¢ **Atraso ou aus√™ncia da fala** - n√£o fala palavras aos 12 meses, frases aos 24 meses\n‚Ä¢ **N√£o aponta** - n√£o usa gestos para mostrar interesse ou pedir algo\n‚Ä¢ **Perda de habilidades** - para de usar palavras que j√° sabia\n\n**üë• Intera√ß√£o Social:**\n‚Ä¢ **Sorriso social ausente** - n√£o sorri de volta aos 6 meses\n‚Ä¢ **Prefer√™ncia por brincar sozinho** - n√£o busca compartilhar brincadeiras\n‚Ä¢ **N√£o imita** - n√£o copia gestos simples como "tchau"\n‚Ä¢ **Dificuldade com afeto** - n√£o busca ou evita carinho\n\n**üîÑ Comportamentos:**\n‚Ä¢ **Movimentos repetitivos** - balan√ßar, bater palmas, girar objetos\n‚Ä¢ **Fixa√ß√£o intensa** - obsess√£o por objetos espec√≠ficos (rodas, luzes)\n‚Ä¢ **Resist√™ncia a mudan√ßas** - choro intenso com altera√ß√µes na rotina\n‚Ä¢ **Sensibilidades sensoriais** - rea√ß√µes extremas a sons, texturas ou luzes\n\nüìù **Marcos Importantes:**\n‚Ä¢ 6 meses: deve sorrir socialmente\n‚Ä¢ 12 meses: deve apontar e usar gestos\n‚Ä¢ 18 meses: deve falar pelo menos 6 palavras\n‚Ä¢ 24 meses: deve combinar 2 palavras\n\n‚ö†Ô∏è **Lembre-se:** Cada crian√ßa se desenvolve no seu ritmo, mas se voc√™ observa v√°rios destes sinais, procure avalia√ß√£o profissional. Diagn√≥stico precoce permite interven√ß√µes mais eficazes!',
      'follow_up': ['diagnostico', 'profissionais', 'quando_procurar']
    },
    
    'sintomas_escolares': {
      'keywords': ['escola', 'sintomas escola', 'professor', 'sala de aula', 'escolar', 'na escola', 'sintomas na escola', 'sinais na escola', 'comportamento escola'],
      'response': 'üè´ **Sinais na Escola**\n\n**Para Professores:**\n‚Ä¢ Dificuldade em seguir instru√ß√µes complexas\n‚Ä¢ Evita atividades em grupo\n‚Ä¢ Comportamentos repetitivos\n‚Ä¢ Sensibilidade a ru√≠dos/luzes\n‚Ä¢ Interesses muito espec√≠ficos\n‚Ä¢ Dificuldade com mudan√ßas na rotina\n\n**Estrat√©gias:**\n‚Ä¢ Use comunica√ß√£o visual\n‚Ä¢ Mantenha rotinas previs√≠veis\n‚Ä¢ Ofere√ßa pausas sensoriais\n‚Ä¢ Valorize os pontos fortes\n\nüìö Cada crian√ßa √© √∫nica!',
      'follow_up': ['inclusao_escolar', 'estrategias_ensino', 'direitos_escola']
    },
    
    'sintomas_mais_velhos': {
      'keywords': ['filho mais velho', 'crian√ßa mais velha', 'sintomas mais velho', 'mais velho', 'idade escolar', '6 anos', '7 anos', '8 anos', '9 anos', '10 anos', 'sintomas filho mais velho', 'crian√ßa grande', 'filho grande', 'adolescente', 'pr√©-adolescente'],
      'response': 'üßí **Sintomas em Crian√ßas Mais Velhas (6+ anos)**\n\n**Comunica√ß√£o:**\n‚Ä¢ Linguagem literal, n√£o entende ironias\n‚Ä¢ Dificuldade em conversas rec√≠procas\n‚Ä¢ Repete frases ou palavras\n‚Ä¢ Voz mon√≥tona ou diferente\n\n**Social:**\n‚Ä¢ Dificuldade para fazer amigos\n‚Ä¢ N√£o entende regras sociais\n‚Ä¢ Prefere brincar sozinho\n‚Ä¢ N√£o compartilha interesses\n\n**Comportamento:**\n‚Ä¢ Rotinas r√≠gidas\n‚Ä¢ Interesses obsessivos\n‚Ä¢ Movimentos repetitivos\n‚Ä¢ Resist√™ncia a mudan√ßas\n\n**Na Escola:**\n‚Ä¢ Dificuldade de concentra√ß√£o\n‚Ä¢ Problemas com trabalhos em grupo\n‚Ä¢ Sensibilidade sensorial\n\nüë©‚öïÔ∏è **Procure avalia√ß√£o profissional!**',
      'follow_up': ['diagnostico', 'escola', 'terapias']
    },
    
    'diagnostico': {
      'keywords': ['diagn√≥stico', 'm√©dico', 'profissional', 'como diagnosticar', 'exames'],
      'response': 'üè• **Diagn√≥stico do TEA - Processo Completo**\n\n**üë©‚öïÔ∏è Profissionais Qualificados:**\n‚Ä¢ **Neuropediatra** - especialista em desenvolvimento neurol√≥gico infantil\n‚Ä¢ **Psiquiatra infantil** - foco em sa√∫de mental da crian√ßa\n‚Ä¢ **Psic√≥logo especializado** - com forma√ß√£o em TEA e desenvolvimento\n‚Ä¢ **Equipe multidisciplinar** - fonoaudi√≥logo, terapeuta ocupacional, psicopedagogo\n\n**üìã Processo Diagn√≥stico:**\n‚Ä¢ **Anamnese detalhada** - hist√≥rico familiar, gravidez, parto, desenvolvimento\n‚Ä¢ **Observa√ß√£o cl√≠nica** - comportamento da crian√ßa em diferentes situa√ß√µes\n‚Ä¢ **Escalas padronizadas:**\n  - CARS (Childhood Autism Rating Scale)\n  - ADI-R (Autism Diagnostic Interview-Revised)\n  - ADOS (Autism Diagnostic Observation Schedule)\n‚Ä¢ **Avalia√ß√£o do desenvolvimento** - marcos motores, cognitivos, sociais\n‚Ä¢ **Exames complementares** - quando necess√°rio descartar outras condi√ß√µes\n\n**üìÖ Linha do Tempo:**\n‚Ä¢ **18 meses:** idade m√≠nima para diagn√≥stico confi√°vel\n‚Ä¢ **2-3 anos:** per√≠odo ideal para identifica√ß√£o\n‚Ä¢ **Qualquer idade:** nunca √© tarde para buscar avalia√ß√£o\n\n**üìù O que Levar na Consulta:**\n‚Ä¢ Caderneta de vacina√ß√£o\n‚Ä¢ Relat√≥rios escolares\n‚Ä¢ V√≠deos do comportamento da crian√ßa\n‚Ä¢ Lista de preocupa√ß√µes observadas\n\n‚è∞ **Por que o diagn√≥stico precoce √© crucial?**\n‚Ä¢ Permite interven√ß√µes mais eficazes\n‚Ä¢ Melhora progn√≥stico de desenvolvimento\n‚Ä¢ Facilita adapta√ß√µes escolares\n‚Ä¢ Orienta a fam√≠lia adequadamente',
      'follow_up': ['terapias', 'intervencao_precoce', 'onde_buscar_ajuda']
    },
    
    'terapias': {
      'keywords': ['terapia', 'tratamento', 'aba', 'interven√ß√£o', 'ajuda', 'como tratar'],
      'response': 'üéØ **Terapias Baseadas em Evid√™ncias para TEA**\n\n**üß† ABA (An√°lise do Comportamento Aplicada):**\n‚Ä¢ **O que √©:** M√©todo cient√≠fico que ensina habilidades atrav√©s de refor√ßo positivo\n‚Ä¢ **Como funciona:** Quebra habilidades complexas em passos pequenos\n‚Ä¢ **Benef√≠cios:** Melhora comunica√ß√£o, comportamento social, autonomia\n‚Ä¢ **Intensidade:** 20-40 horas semanais para melhores resultados\n‚Ä¢ **Idade ideal:** Quanto mais cedo, melhor (2-6 anos)\n\n**üó£Ô∏è Fonoaudiologia:**\n‚Ä¢ **Comunica√ß√£o verbal:** Desenvolvimento da fala e linguagem\n‚Ä¢ **Comunica√ß√£o alternativa:** PECS, gestos, dispositivos eletr√¥nicos\n‚Ä¢ **Pragm√°tica:** Uso social da linguagem, conversa√ß√£o\n‚Ä¢ **Degluti√ß√£o:** Problemas alimentares e seletividade\n\n**ü§≤ Terapia Ocupacional:**\n‚Ä¢ **Integra√ß√£o sensorial:** Processamento de est√≠mulos (tato, som, movimento)\n‚Ä¢ **Atividades di√°rias:** Vestir, comer, higiene pessoal\n‚Ä¢ **Coordena√ß√£o motora:** Habilidades finas e grossas\n‚Ä¢ **Autorregula√ß√£o:** T√©cnicas para controle emocional\n\n**üßò Psicoterapia:**\n‚Ä¢ **Terapia Cognitivo-Comportamental:** Para ansiedade e comportamentos\n‚Ä¢ **Habilidades sociais:** Intera√ß√£o, amizades, regras sociais\n‚Ä¢ **Regula√ß√£o emocional:** Reconhecer e expressar sentimentos\n‚Ä¢ **Apoio familiar:** Orienta√ß√£o para pais e irm√£os\n\n**üéµ Terapias Complementares:**\n‚Ä¢ **Musicoterapia:** Desenvolvimento social e emocional\n‚Ä¢ **Equoterapia:** Melhora equil√≠brio, coordena√ß√£o e autoestima\n‚Ä¢ **Nata√ß√£o:** Exerc√≠cio f√≠sico e relaxamento\n‚Ä¢ **Arteterapia:** Express√£o criativa e comunica√ß√£o\n\nüìù **Plano Individualizado:**\nCada pessoa com TEA √© √∫nica. O plano terap√™utico deve considerar:\n‚Ä¢ N√≠vel de funcionamento\n‚Ä¢ Idade e interesses\n‚Ä¢ Necessidades espec√≠ficas\n‚Ä¢ Recursos familiares\n\n‚ú® **Dica:** Combine diferentes terapias para resultados mais eficazes!',
      'follow_up': ['aba_detalhes', 'fonoaudiologia', 'terapia_ocupacional']
    },
    
    'comportamentos_dificeis': {
      'keywords': ['crise', 'birra', 'agressivo', 'comportamento dif√≠cil', 'meltdown', 'autoles√£o'],
      'response': 'üßò‚ôÄÔ∏è **Comportamentos Desafiadores**\n\n**Poss√≠veis Causas:**\n‚Ä¢ Sobrecarga sensorial\n‚Ä¢ Mudan√ßa na rotina\n‚Ä¢ Frustra√ß√£o/comunica√ß√£o\n‚Ä¢ Fome, sono, dor\n‚Ä¢ Ansiedade\n\n**Como Ajudar:**\n‚Ä¢ Mantenha-se calmo\n‚Ä¢ Identifique o gatilho\n‚Ä¢ Reduza est√≠mulos\n‚Ä¢ Use poucas palavras, tom suave\n‚Ä¢ Ofere√ßa alternativas\n‚Ä¢ Valide os sentimentos\n\n**Preven√ß√£o:**\n‚Ä¢ Rotinas previs√≠veis\n‚Ä¢ Comunica√ß√£o visual\n‚Ä¢ Pausas regulares\n‚Ä¢ Ambiente organizado\n\nüíô **N√£o √© birra - √© comunica√ß√£o!**',
      'follow_up': ['estrategias_comportamento', 'sobrecarga_sensorial', 'rotinas']
    },
    
    'familia_apoio': {
      'keywords': ['fam√≠lia', 'pais', 'm√£e', 'pai', 'como ajudar fam√≠lia', 'apoio'],
      'response': 'üë®üë©üëßüë¶ **Apoio √† Fam√≠lia**\n\n**Para Pais:**\n‚Ä¢ Aceite seu filho como ele √©\n‚Ä¢ Celebre pequenas conquistas\n‚Ä¢ Busque informa√ß√£o confi√°vel\n‚Ä¢ Conecte-se com outras fam√≠lias\n‚Ä¢ Cuide da sua sa√∫de mental\n\n**Estrat√©gias Pr√°ticas:**\n‚Ä¢ Crie rotinas visuais\n‚Ä¢ Use interesses da crian√ßa\n‚Ä¢ Tenha paci√™ncia com o desenvolvimento\n‚Ä¢ Documente progressos\n\n**Rede de Apoio:**\n‚Ä¢ Grupos de pais\n‚Ä¢ Associa√ß√µes de autismo\n‚Ä¢ Terapeutas\n‚Ä¢ Escola\n\nüí™ **Voc√™ conhece seu filho melhor que ningu√©m!**',
      'follow_up': ['grupos_apoio', 'autocuidado_pais', 'irm√£os_autismo']
    },
    
    'direitos': {
      'keywords': ['direitos', 'lei', 'benef√≠cio', 'gratuito', 'bpc', 'carteirinha'],
      'response': '‚öñÔ∏è **Direitos da Pessoa com TEA**\n\n**Lei 12.764/2012 (Berenice Piana):**\n‚Ä¢ Pessoa com defici√™ncia para todos os efeitos legais\n\n**Principais Direitos:**\n‚Ä¢ üé´ Prioridade em filas e atendimentos\n‚Ä¢ üöå Transporte p√∫blico gratuito\n‚Ä¢ üí∞ BPC - Benef√≠cio de 1 sal√°rio m√≠nimo\n‚Ä¢ üè• Atendimento especializado no SUS\n‚Ä¢ üè´ Educa√ß√£o inclusiva\n‚Ä¢ üíº Cotas no mercado de trabalho\n‚Ä¢ üé≠ Meia-entrada em eventos\n\n**Documentos:**\n‚Ä¢ Carteirinha de identifica√ß√£o\n‚Ä¢ Laudo m√©dico\n‚Ä¢ CID F84\n\nüìã **Use seus direitos!**',
      'follow_up': ['bpc_como_solicitar', 'carteirinha_autismo', 'direitos_escola']
    },
    
    'inclusao_escolar': {
      'keywords': ['inclus√£o', 'escola inclusiva', 'professor apoio', 'adapta√ß√£o escolar'],
      'response': 'üè´ **Inclus√£o Escolar**\n\n**Direitos Garantidos:**\n‚Ä¢ Matr√≠cula em escola regular\n‚Ä¢ Professor de apoio (se necess√°rio)\n‚Ä¢ Adapta√ß√µes curriculares\n‚Ä¢ Ambiente acess√≠vel\n\n**Estrat√©gias para Professores:**\n‚Ä¢ Comunica√ß√£o visual (pictogramas)\n‚Ä¢ Rotinas estruturadas\n‚Ä¢ Pausas sensoriais\n‚Ä¢ Atividades baseadas em interesses\n‚Ä¢ Parceria com fam√≠lia\n\n**Adapta√ß√µes:**\n‚Ä¢ Tempo extra para atividades\n‚Ä¢ Avalia√ß√µes diferenciadas\n‚Ä¢ Espa√ßo para autorregula√ß√£o\n‚Ä¢ Redu√ß√£o de est√≠mulos\n\nüåü **Inclus√£o beneficia toda a turma!**',
      'follow_up': ['pei_plano', 'professor_apoio', 'adaptacoes_curriculares']
    },
    
    'comunicacao': {
      'keywords': ['comunica√ß√£o', 'fala', 'linguagem', 'n√£o fala', 'verbal', 'pecs'],
      'response': 'üó£Ô∏è **Comunica√ß√£o no TEA**\n\n**Formas de Comunica√ß√£o:**\n‚Ä¢ **Verbal:** palavras, frases\n‚Ä¢ **N√£o-verbal:** gestos, express√µes\n‚Ä¢ **Visual:** figuras, pictogramas\n‚Ä¢ **Tecnol√≥gica:** tablets, apps\n\n**Estrat√©gias:**\n‚Ä¢ PECS (troca de figuras)\n‚Ä¢ Libras ou gestos\n‚Ä¢ Comunica√ß√£o aumentativa\n‚Ä¢ Rotinas visuais\n‚Ä¢ Hist√≥rias sociais\n\n**Dicas Pr√°ticas:**\n‚Ä¢ D√™ tempo para resposta\n‚Ä¢ Use linguagem simples\n‚Ä¢ Seja paciente e consistente\n\nüéØ **Toda comunica√ß√£o √© v√°lida!**',
      'follow_up': ['pecs', 'apps_comunicacao', 'fonoaudiologia']
    },
    
    'sensorial': {
      'keywords': ['sensorial', 'hipersensibilidade', 'hiposensibilidade', 'ru√≠do', 'textura', 'luz'],
      'response': 'üåà **Quest√µes Sensoriais**\n\n**Hipersensibilidade (muito sens√≠vel):**\n‚Ä¢ Evita ru√≠dos, luzes fortes\n‚Ä¢ N√£o gosta de certas texturas\n‚Ä¢ Incomoda-se com multid√µes\n‚Ä¢ Rejeita alguns alimentos\n\n**Hiposensibilidade (pouco sens√≠vel):**\n‚Ä¢ Busca est√≠mulos intensos\n‚Ä¢ N√£o sente dor/temperatura\n‚Ä¢ Precisa de mais input sensorial\n\n**Estrat√©gias:**\n‚Ä¢ Identifique os gatilhos\n‚Ä¢ Crie espa√ßos calmos\n‚Ä¢ Use fones de ouvido\n‚Ä¢ Ofere√ßa alternativas t√°teis\n‚Ä¢ Gradual exposi√ß√£o\n\nüßò **Terapia ocupacional ajuda muito!**',
      'follow_up': ['terapia_ocupacional', 'dieta_sensorial', 'ambiente_sensorial']
    },
    
    'alimentacao': {
      'keywords': ['alimenta√ß√£o', 'comida', 'seletividade', 'n√£o come', 'textura alimento'],
      'response': 'üçΩÔ∏è **Alimenta√ß√£o no TEA**\n\n**Seletividade Alimentar:**\n‚Ä¢ Comum em 70% das crian√ßas\n‚Ä¢ Prefer√™ncias por textura/cor\n‚Ä¢ Resist√™ncia a novos alimentos\n‚Ä¢ Rituais na hora da refei√ß√£o\n\n**Estrat√©gias:**\n‚Ä¢ Introdu√ß√£o gradual\n‚Ä¢ Misture alimentos aceitos\n‚Ä¢ Deixe explorar sem press√£o\n‚Ä¢ Modelo (coma junto)\n‚Ä¢ Ambiente calmo\n‚Ä¢ Hor√°rios regulares\n\n**Quando Buscar Ajuda:**\n‚Ä¢ Perda de peso\n‚Ä¢ Defici√™ncias nutricionais\n‚Ä¢ Menos de 20 alimentos aceitos\n\nü•ó **Paciencia e persist√™ncia!**',
      'follow_up': ['nutricionista', 'suplementos', 'receitas_sensoriais']
    },
    
    'sono': {
      'keywords': ['sono', 'dormir', 'ins√¥nia', 'n√£o dorme', 'acordar noite'],
      'response': 'üåô **Sono no TEA**\n\n**Problemas Comuns:**\n‚Ä¢ Dificuldade para adormecer\n‚Ä¢ Despertares noturnos\n‚Ä¢ Sono fragmentado\n‚Ä¢ Resist√™ncia √† hora de dormir\n\n**Higiene do Sono:**\n‚Ä¢ Rotina consistente\n‚Ä¢ Ambiente escuro e silencioso\n‚Ä¢ Temperatura agrad√°vel\n‚Ä¢ Evite telas 1h antes\n‚Ä¢ Atividade f√≠sica durante o dia\n\n**Estrat√©gias:**\n‚Ä¢ Hist√≥ria visual da rotina\n‚Ä¢ M√∫sica relaxante\n‚Ä¢ Massagem suave\n‚Ä¢ Objetos de transi√ß√£o\n‚Ä¢ Melatonina (com orienta√ß√£o m√©dica)\n\nüò¥ **Sono de qualidade melhora tudo!**',
      'follow_up': ['rotina_sono', 'melatonina', 'ambiente_dormir']
    },
    
    'tecnologia': {
      'keywords': ['app', 'tecnologia', 'tablet', 'aplicativo', 'digital'],
      'response': 'üì± **Tecnologia e TEA**\n\n**Benef√≠cios:**\n‚Ä¢ Comunica√ß√£o aumentativa\n‚Ä¢ Aprendizado visual\n‚Ä¢ Organiza√ß√£o de rotinas\n‚Ä¢ Habilidades sociais\n‚Ä¢ Autorregula√ß√£o\n\n**Apps √öteis:**\n‚Ä¢ **Comunica√ß√£o:** Proloquo2Go, PECS\n‚Ä¢ **Rotinas:** Choiceworks, First Then\n‚Ä¢ **Habilidades Sociais:** Social Stories\n‚Ä¢ **Relaxamento:** Calm, Headspace\n‚Ä¢ **Educa√ß√£o:** Khan Academy Kids\n\n**Dicas de Uso:**\n‚Ä¢ Tempo limitado\n‚Ä¢ Conte√∫do apropriado\n‚Ä¢ Supervis√£o adulta\n‚Ä¢ Equil√≠brio com atividades offline\n\nüéØ **Ferramenta, n√£o substituto da intera√ß√£o!**',
      'follow_up': ['apps_comunicacao', 'tempo_tela', 'jogos_educativos']
    },
    
    'casos_praticos': {
      'keywords': ['meu filho', 'minha filha', 'crian√ßa', 'o que fazer', 'estou preocupado', 'n√£o sei o que fazer', 'preciso de ajuda'],
      'response': 'ü§± **Situa√ß√µes Pr√°ticas**\n\n**Se voc√™ suspeita de TEA:**\n‚Ä¢ Observe sem julgar\n‚Ä¢ Anote comportamentos espec√≠ficos\n‚Ä¢ Procure pediatra ou neuropediatra\n‚Ä¢ N√£o compare com outras crian√ßas\n\n**Primeiros Passos:**\n1. Consulta m√©dica especializada\n2. Avalia√ß√£o multidisciplinar\n3. In√≠cio de terapias (se indicado)\n4. Apoio √† fam√≠lia\n\n**Lembre-se:**\n‚Ä¢ Cada crian√ßa √© √∫nica\n‚Ä¢ Diagn√≥stico precoce ajuda\n‚Ä¢ Voc√™ n√£o est√° sozinho\n‚Ä¢ H√° muito apoio dispon√≠vel\n\nüíô **O amor e aceita√ß√£o s√£o fundamentais!**',
      'follow_up': ['diagnostico', 'primeiros_passos', 'apoio_familia']
    },
    
    'emergencia': {
      'keywords': ['crise agora', 'emerg√™ncia', 'n√£o para de chorar', 'agressivo agora', 'socorro', 'urgente ajuda'],
      'response': 'üö® **Situa√ß√£o de Crise - A√ß√£o Imediata**\n\n**AGORA:**\n‚Ä¢ Mantenha-se calmo\n‚Ä¢ Reduza est√≠mulos (luz, som)\n‚Ä¢ Fale baixo e devagar\n‚Ä¢ N√£o force contato f√≠sico\n‚Ä¢ Ofere√ßa espa√ßo seguro\n\n**N√ÉO FA√áA:**\n‚Ä¢ N√£o grite ou se desespere\n‚Ä¢ N√£o force a parar\n‚Ä¢ N√£o d√™ ordens complexas\n‚Ä¢ N√£o toque sem permiss√£o\n\n**DEPOIS DA CRISE:**\n‚Ä¢ Ofere√ßa conforto\n‚Ä¢ Hidrate a crian√ßa\n‚Ä¢ Analise poss√≠veis gatilhos\n‚Ä¢ Documente o ocorrido\n\n‚ö†Ô∏è **Se houver risco f√≠sico, procure ajuda m√©dica imediata!**\n\nüíô **Crises passam. Voc√™ consegue!**',
      'follow_up': ['comportamentos_dificeis', 'estrategias_crise', 'apoio_emergencial']
    },
    
    'recursos_gratuitos': {
      'keywords': ['gratuito', 'sem dinheiro', 'n√£o tenho condi√ß√µes', 'sus', 'p√∫blico', 'barato'],
      'response': 'üÜì **Recursos Gratuitos Dispon√≠veis**\n\n**SUS - Sistema √önico de Sa√∫de:**\n‚Ä¢ Consultas especializadas\n‚Ä¢ Terapias (ABA, fono, TO)\n‚Ä¢ Medicamentos\n‚Ä¢ Acompanhamento multidisciplinar\n\n**APAE - Associa√ß√£o de Pais e Amigos:**\n‚Ä¢ Atendimento especializado\n‚Ä¢ Terapias\n‚Ä¢ Orienta√ß√£o familiar\n‚Ä¢ Atividades educativas\n\n**Universidades:**\n‚Ä¢ Cl√≠nicas-escola\n‚Ä¢ Atendimento supervisionado\n‚Ä¢ Pesquisas e estudos\n\n**ONGs e Associa√ß√µes:**\n‚Ä¢ Grupos de apoio\n‚Ä¢ Orienta√ß√£o gratuita\n‚Ä¢ Eventos educativos\n‚Ä¢ Rede de contatos\n\nüìç **Procure a Secretaria de Sa√∫de da sua cidade!**',
      'follow_up': ['sus_como_acessar', 'apae_local', 'associacoes']
    }
  };

  static const Map<String, String> _quickResponses = {
    'oi': 'üëã Oi! Sou especialista em TEA. Como posso ajudar hoje?',
    'ol√°': 'üëã Ol√°! Estou aqui para esclarecer suas d√∫vidas sobre autismo.',
    'bom dia': '‚òÄÔ∏è Bom dia! Pronto para ajudar com informa√ß√µes sobre TEA.',
    'boa tarde': 'üåÖ Boa tarde! Como posso auxiliar sobre autismo hoje?',
    'boa noite': 'üåô Boa noite! Estou dispon√≠vel para suas perguntas sobre TEA.',
    'obrigado': 'üòä Por nada! Sempre aqui para ajudar. Cada pessoa com autismo √© especial!',
    'obrigada': 'üòä Fico feliz em ajudar! Juntos construimos mais inclus√£o.',
    'tchau': 'üëã At√© logo! Lembre-se: voc√™ n√£o est√° sozinho nessa jornada!',
    'at√© mais': 'üëã At√© mais! Estarei sempre aqui quando precisar.',
    'ajuda': 'üí° Posso ajudar com: sintomas, diagn√≥stico, terapias, escola, fam√≠lia, direitos e desenvolvimento. Seja espec√≠fico!',
    'n√£o sei': 'ü§î Sem problemas! Me conte o que est√° acontecendo ou qual sua preocupa√ß√£o. Vamos descobrir juntos!',
    'estou perdido': 'ü§≠ N√£o se preocupe! √â normal se sentir assim. Vamos come√ßar pelo b√°sico. O que voc√™ gostaria de saber?',
    'urgente': '‚ö†Ô∏è Se for emerg√™ncia m√©dica, procure ajuda imediata! Para d√∫vidas sobre TEA, estou aqui para ajudar.',
    'crise': 'üÜò Em situa√ß√µes de crise: mantenha calma, reduza est√≠mulos, use voz suave. Precisa de mais orienta√ß√µes?',
    'sintomas': 'üë∂ **Sintomas do TEA por Faixa Et√°ria:**\n\n‚Ä¢ **0-3 anos:** Pouco contato visual, n√£o responde ao nome, atraso na fala\n‚Ä¢ **3-6 anos:** Dificuldades sociais, comportamentos repetitivos, resist√™ncia a mudan√ßas\n‚Ä¢ **6+ anos:** Linguagem literal, interesses obsessivos, dificuldades de amizade\n‚Ä¢ **Adolescentes:** Ansiedade social, dificuldades acad√™micas, isolamento\n\nüìù **Importante:** Sintomas variam muito entre indiv√≠duos. Alguns podem ser mais sutis.\n\nSobre qual idade voc√™ gostaria de saber mais detalhes?',
    'sinais': 'üîç **Principais Sinais do TEA (Tr√≠ade Cl√°ssica):**\n\n**1Ô∏è‚É£ Comunica√ß√£o:**\n‚Ä¢ Atraso ou aus√™ncia da fala\n‚Ä¢ Dificuldade para iniciar/manter conversas\n‚Ä¢ Uso repetitivo da linguagem (ecolalia)\n\n**2Ô∏è‚É£ Intera√ß√£o Social:**\n‚Ä¢ Dificuldade em fazer amigos\n‚Ä¢ N√£o compartilha interesses\n‚Ä¢ Problemas com contato visual\n\n**3Ô∏è‚É£ Comportamentos Repetitivos:**\n‚Ä¢ Movimentos estereotipados\n‚Ä¢ Insist√™ncia em rotinas\n‚Ä¢ Interesses restritos e intensos\n\n**Plus:** Sensibilidades sensoriais (hiper/hiposensibilidade)\n\nQuer detalhes sobre algum sinal espec√≠fico?'
  };

  static String? findResponse(String message) {
    final msg = message.toLowerCase().trim();
    
    if (_responseCache.containsKey(msg)) {
      return _responseCache[msg];
    }
    
    for (final entry in _quickResponses.entries) {
      if (msg.contains(entry.key)) {
        _cacheResponse(msg, entry.value);
        return entry.value;
      }
    }
    
    String? bestMatch;
    int bestScore = 0;
    
    for (final entry in _knowledge.entries) {
      final keywords = entry.value['keywords'] as List<String>;
      int score = 0;
      
      for (final keyword in keywords) {
        final keywordLower = keyword.toLowerCase();
        if (msg.contains(keywordLower)) {
          if (msg == keywordLower) {
            score += 10;
          } else if (msg.startsWith(keywordLower) || msg.endsWith(keywordLower)) {
            score += 5;
          } else {
            score += 2;
          }
          score += keywordLower.split(' ').length;
        }
      }
      
      if (score > bestScore) {
        bestScore = score;
        bestMatch = entry.value['response'] as String;
      }
    }
    
    if (bestMatch != null) {
      _cacheResponse(msg, bestMatch);
    }
    
    return bestMatch;
  }
  
  static void _cacheResponse(String message, String response) {
    if (_responseCache.length >= _maxCacheSize) {
      final firstKey = _responseCache.keys.first;
      _responseCache.remove(firstKey);
    }
    _responseCache[message] = response;
  }
  
  static List<String> getFollowUpSuggestions(String message) {
    final msg = message.toLowerCase().trim();
    
    String? bestTopic;
    int maxMatches = 0;
    
    for (final entry in _knowledge.entries) {
      final keywords = entry.value['keywords'] as List<String>;
      int matches = 0;
      
      for (final keyword in keywords) {
        if (msg.contains(keyword.toLowerCase())) {
          matches++;
        }
      }
      
      if (matches > maxMatches) {
        maxMatches = matches;
        bestTopic = entry.key;
      }
    }
    
    if (bestTopic != null) {
      return List<String>.from(_knowledge[bestTopic]!['follow_up'] ?? []);
    }
    
    return ['Como identificar autismo?', 'Que terapias funcionam?', 'Direitos da pessoa com TEA'];
  }
  
  static String getDefaultResponse() {
    return 'üíô **Ol√°! Estou aqui para apoiar voc√™ nessa jornada.**\n\nüéØ **Posso ajudar com:**\n‚Ä¢ Identificar sinais do TEA\n‚Ä¢ Orientar sobre diagn√≥stico\n‚Ä¢ Sugerir terapias eficazes\n‚Ä¢ Apoiar a inclus√£o escolar\n‚Ä¢ Esclarecer direitos\n‚Ä¢ Oferecer suporte emocional\n\n**üí° Seja espec√≠fico:**\n‚Ä¢ "Meu filho tem 3 anos e n√£o fala"\n‚Ä¢ "Como lidar com birras?"\n‚Ä¢ "Preciso de ajuda gratuita"\n\nü§ó **Voc√™ n√£o est√° sozinho(a). Vamos conversar?**';
  }
  
  static void clearCache() {
    _responseCache.clear();
  }
  
  static List<String> getSmartSuggestions() {
    return [
      'Sinais de autismo por idade',
      'Meu filho n√£o fala',
      'Como lidar com crises',
      'Terapias que funcionam',
      'Direitos na escola',
      'Ajuda gratuita dispon√≠vel',
      'Problemas de sono',
      'Seletividade alimentar'
    ];
  }
  
  static void optimizeMemory() {
    if (_responseCache.length > _maxCacheSize ~/ 2) {
      final keysToRemove = _responseCache.keys.take(_responseCache.length ~/ 2).toList();
      for (final key in keysToRemove) {
        _responseCache.remove(key);
      }
    }
  }
}